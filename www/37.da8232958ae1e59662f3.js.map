{"version":3,"sources":["./src/app/pages/tradein/edit-tradein/tradein-profile/components/tradein-form-my/tradein-form-my.component.ts","./src/app/pages/tradein/edit-tradein/tradein-profile/components/tradein-form-my/tradein-form-my.component.html","./src/app/pages/tradein/edit-tradein/tradein-profile/tradein-profile.page.html","./src/app/pages/tradein/edit-tradein/tradein-profile/tradein-profile-routing.module.ts","./src/app/pages/tradein/edit-tradein/tradein-profile/tradein-profile.page.ts","./src/app/pages/tradein/edit-tradein/tradein-profile/tradein-profile.module.ts"],"names":["TradeinFormMyComponent","translate","tdChange","this","addToForm","changes","tradein","Chassis","form","get","value","RegDate","YearMake","Make","Model","Variant","Color","TradeInSource","ExpectedPrice","Overtrade","Warranty","emit","addControl","required","updateFormMsg","subscribe","lang","messages","chassis","make","model","tradeInSource","routes","path","PARAM_ID","children","component","TradeinProfilePage","formBuilder","navCtrl","loadingCtrl","tradeinSrvc","route","oppSrvc","modalCtrl","subs","Subscription","countryCode","environment","tradeinForm","initTradeInForm","add","parseURL","opp","paramMap","params","console","log","OpportunityId","ContactId","CONTACT_ID","getData","pipe","mergeMap","from","create","message","loading","present","forkJoin","getOpportunityById","tap","e","dismiss","err","componentProps","callbackFn","searchStr","getPurchasers","transformFn","purchaser","Title","Name","noResultFn","backdropDismiss","modal","onDidDismiss","modalData","data","Purchaser","Id","Company","setValue","group","id","regNo","mileage","remarks","initErrorMessages","formErrorMessages","key","Object","keys","controls","td","RegNo","Mileage","Notes","upsertTradeIn","back","setTimeout","_","navigateForward","BASE","done","selectPurchaser","pathMatch","TradeinProfilePageRoutingModule","forChild","TradeinProfilePageModule"],"mappings":"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","file":"37.da8232958ae1e59662f3.js","sourcesContent":["import { Component, OnInit, Input, Output, EventEmitter, OnChanges, SimpleChange } from '@angular/core';\nimport { TradeIn } from 'src/app/models/common/tradein.model';\nimport { FormGroup, FormControl, Validators } from '@angular/forms';\nimport { FormErrorMessages } from 'src/app/models/common/form-error.model';\nimport { TranslateService } from '@ngx-translate/core';\n\n@Component({\n  selector: 'app-tradein-form-my',\n  templateUrl: './tradein-form-my.component.html',\n  styleUrls: ['./tradein-form-my.component.scss'],\n})\nexport class TradeinFormMyComponent implements OnInit, OnChanges {\n  @Input() form: FormGroup;\n  @Input() messages: FormErrorMessages;\n  @Input() tradein: TradeIn;\n  @Output() tdChange = new EventEmitter<TradeIn>();\n\n  constructor(private translate: TranslateService) {}\n\n  ngOnInit() {\n    this.addToForm();\n  }\n\n  ngOnChanges(changes: { [propKey: string]: SimpleChange }) {}\n\n  emit() {\n    this.tradein.Chassis = this.form.get('chassis').value;\n    this.tradein.RegDate = this.form.get('regDate').value;\n    this.tradein.YearMake = this.form.get('yearMake').value;\n    this.tradein.Make = this.form.get('make').value;\n    this.tradein.Model = this.form.get('model').value;\n    this.tradein.Variant = this.form.get('variant').value;\n    this.tradein.Color = this.form.get('color').value;\n    this.tradein.TradeInSource = this.form.get('tradeInSource').value;\n    this.tradein.ExpectedPrice = this.form.get('expectedPrice').value;\n    this.tradein.Overtrade = this.form.get('overtrade').value;\n    this.tradein.Warranty = this.form.get('warranty').value;\n    this.tdChange.emit(this.tradein);\n  }\n\n  private addToForm() {\n    if (!this.form) {\n      return;\n    }\n    this.form.addControl('chassis', new FormControl('', [Validators.required]));\n    this.form.addControl('regDate', new FormControl('', [Validators.required]));\n    this.form.addControl('yearMake', new FormControl(''));\n    this.form.addControl('make', new FormControl('', [Validators.required]));\n    this.form.addControl('model', new FormControl('', [Validators.required]));\n    this.form.addControl('variant', new FormControl(''));\n    this.form.addControl('color', new FormControl(''));\n    this.form.addControl('tradeInSource', new FormControl('', [Validators.required]));\n    this.form.addControl('expectedPrice', new FormControl(''));\n    this.form.addControl('overtrade', new FormControl(''));\n    this.form.addControl('warranty', new FormControl(''));\n    this.updateFormMsg();\n  }\n\n  private updateFormMsg() {\n    this.translate.get('Error_CannotBeEmpty').subscribe((lang) => {\n      this.messages.chassis = {\n        required: lang,\n      };\n      this.messages.make = {\n        required: lang,\n      };\n      this.messages.model = {\n        required: lang,\n      };\n      this.messages.tradeInSource = {\n        required: lang,\n      };\n    });\n  }\n}\n","<form [formGroup]=\"form\">\n  <ion-item>\n    <ion-input formControlName=\"chassis\" placeholder=\"{{ 'TradeInProfile_ChassisNo' | translate }}\"></ion-input>\n  </ion-item>\n  <app-item-err [control]=\"form.controls?.chassis\" [messages]=\"messages.chassis\"></app-item-err>\n  <ion-item>\n    <ion-datetime displayFormat=\"MM/DD/YYYY\" formControlName=\"regDate\" placeholder=\"{{ 'TradeInProfile_RegistrationDate' | translate }}\"></ion-datetime>\n  </ion-item>\n  <app-item-err [control]=\"form.controls?.regDate\" [messages]=\"messages.regDate\"></app-item-err>\n  <ion-item>\n    <ion-datetime displayFormat=\"YYYY\" formControlName=\"yearMake\" placeholder=\"{{ 'TradeInProfile_YearMake' | translate }}\"></ion-datetime>\n  </ion-item>\n  <app-item-err [control]=\"form.controls?.yearMake\" [messages]=\"messages.yearMake\"></app-item-err>\n  <ion-item>\n    <ion-input formControlName=\"make\" placeholder=\"{{ 'TradeInProfile_Make' | translate }}\"></ion-input>\n  </ion-item>\n  <app-item-err [control]=\"form.controls?.make\" [messages]=\"messages.make\"></app-item-err>\n  <ion-item>\n    <ion-input formControlName=\"model\" placeholder=\"{{ 'TradeInProfile_Model' | translate }}\"></ion-input>\n  </ion-item>\n  <app-item-err [control]=\"form.controls?.model\" [messages]=\"messages.model\"></app-item-err>\n  <ion-item>\n    <ion-input formControlName=\"variant\" placeholder=\"{{ 'TradeInProfile_Variant' | translate }}\"></ion-input>\n  </ion-item>\n  <app-item-err [control]=\"form.controls?.variant\" [messages]=\"messages.variant\"></app-item-err>\n  <ion-item>\n    <ion-input formControlName=\"color\" placeholder=\"{{ 'TradeInProfile_Color' | translate }}\"></ion-input>\n  </ion-item>\n  <app-item-err [control]=\"form.controls?.color\" [messages]=\"messages.color\"></app-item-err>\n  <ion-item>\n    <ion-input formControlName=\"tradeInSource\" placeholder=\"{{ 'TradeInProfile_TradeInSource' | translate }}\"></ion-input>\n  </ion-item>\n  <app-item-err [control]=\"form.controls?.tradeInSource\" [messages]=\"messages.tradeInSource\"></app-item-err>\n  <ion-item>\n    <ion-input formControlName=\"expectedPrice\" placeholder=\"{{ 'TradeInProfile_ExpectedPrice' | translate }}\"></ion-input>\n  </ion-item>\n  <app-item-err [control]=\"form.controls?.expectedPrice\" [messages]=\"messages.expectedPrice\"></app-item-err>\n  <ion-item>\n    <ion-input formControlName=\"overtrade\" placeholder=\"{{ 'TradeInProfile_Overtrade' | translate }}\"></ion-input>\n  </ion-item>\n  <app-item-err [control]=\"form.controls?.overtrade\" [messages]=\"messages.overtrade\"></app-item-err>\n  <ion-item>\n    <ion-datetime displayFormat=\"YYYY\" formControlName=\"warranty\" placeholder=\"{{ 'TradeInProfile_WarrantyValidity' | translate }}\"></ion-datetime>\n  </ion-item>\n  <app-item-err [control]=\"form.controls?.warranty\" [messages]=\"messages.warranty\"></app-item-err>\n</form>\n","<ion-header>\n  <ion-toolbar color=\"primary\" mode=\"ios\">\n    <ion-buttons slot=\"start\">\n      <ion-back-button defaultHref=\"\" text=\"{{'Common_Cancel'|translate}}\"></ion-back-button>\n    </ion-buttons>\n    <ion-buttons slot=\"end\">\n      <ion-button (click)=\"done()\">{{'Common_Done'|translate}}</ion-button>\n    </ion-buttons>\n    <ion-title>{{'TradeInProfile_NewTradeIn'|translate}}</ion-title>\n  </ion-toolbar>\n</ion-header>\n<ion-content>\n  <form [formGroup]=\"tradeinForm\">\n    <ion-item>\n      <ion-input formControlName=\"regNo\" placeholder='{{\"TradeInProfile_RegistrationNo\"|translate}}'></ion-input>\n    </ion-item>\n    <app-item-err [control]=\"tradeinForm.controls?.regNo\" [messages]=\"formErrorMessages.regNo\"></app-item-err>\n    <ion-item>\n      <ion-input formControlName=\"purchaser\" placeholder='{{\"TradeInProfile_Purchaser\"|translate}}' (click)=\"selectPurchaser()\"></ion-input>\n    </ion-item>\n    <app-item-err [control]=\"tradeinForm.controls?.purchaser\" [messages]=\"formErrorMessages.purchaser\"></app-item-err>\n    <ion-item>\n      <ion-input formControlName=\"mileage\" placeholder='{{\"TradeInProfile_Mileage\"|translate}}'></ion-input>\n    </ion-item>\n    <app-item-err [control]=\"tradeinForm.controls?.mileage\" [messages]=\"formErrorMessages.mileage\"></app-item-err>\n    <app-tradein-form-my\n      [form]=\"tradeinForm\"\n      [tradein]=\"tradein\"\n      [messages]=\"formErrorMessages\"\n      (tdChange)=\"setTradein($event)\"\n      *ngIf=\"countryCode == 'my'\"\n    ></app-tradein-form-my>\n    <ion-item>\n      <ion-textarea rows=\"6\" formControlName=\"remarks\" placeholder='{{\"TradeInProfile_Notes\"|translate}}'></ion-textarea>\n    </ion-item>\n    <app-item-err [control]=\"tradeinForm.controls?.remarks\" [messages]=\"formErrorMessages.remarks\"></app-item-err>\n  </form>\n</ion-content>\n","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { TradeinProfilePage } from './tradein-profile.page';\nimport { TradeinProfilePageRoutingKeys } from './tradein-profile-routing.keys';\n\nconst routes: Routes = [\n  {\n    path: `:${TradeinProfilePageRoutingKeys.PARAM_ID}/:contact`,\n    children: [\n      {\n        path: '',\n        component: TradeinProfilePage,\n        pathMatch: 'full',\n      },\n    ],\n  },\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class TradeinProfilePageRoutingModule {}\n","import { Component, OnInit } from '@angular/core';\nimport { FormGroup, FormBuilder, Validators } from '@angular/forms';\nimport { FormErrorMessages } from 'src/app/models/common/form-error.model';\nimport { Subscription, from, forkJoin } from 'rxjs';\nimport { Purchaser, TradeIn } from 'src/app/models/common/tradein.model';\nimport { TranslateService } from '@ngx-translate/core';\nimport { environment } from 'src/environments/environment';\nimport { mergeMap, tap } from 'rxjs/operators';\nimport { TradeinViewProfilePageRoutingKeys } from '../../view-tradein/view-tradein-routing.keys';\nimport { NavController, LoadingController, ModalController } from '@ionic/angular';\nimport { CommonTradeinService } from 'src/app/services/common/tradein/tradein.service';\nimport { TradeinProfilePageRoutingKeys } from './tradein-profile-routing.keys';\nimport { ActivatedRoute } from '@angular/router';\nimport { Opportunity } from 'src/app/models/common/opportunity.model';\nimport { CommonOpportunityService } from 'src/app/services/common/opportunity/opportunity.service';\nimport { AutocompleteComponent } from 'src/app/components/common/autocomplete/autocomplete.component';\nimport { AutoCompleteModel } from 'src/app/models/common/auto-complete.model';\n\n@Component({\n  selector: 'app-tradein-profile',\n  templateUrl: './tradein-profile.page.html',\n  styleUrls: ['./tradein-profile.page.scss'],\n})\nexport class TradeinProfilePage implements OnInit {\n  private subs = new Subscription();\n  tradeinForm: FormGroup;\n  formErrorMessages: FormErrorMessages;\n  tradein: TradeIn;\n  countryCode = environment.countryCode;\n  opp: Opportunity;\n\n  constructor(\n    private formBuilder: FormBuilder,\n    private translate: TranslateService,\n    private navCtrl: NavController,\n    private loadingCtrl: LoadingController,\n    private tradeinSrvc: CommonTradeinService,\n    private route: ActivatedRoute,\n    private oppSrvc: CommonOpportunityService,\n    private modalCtrl: ModalController\n  ) {}\n\n  ngOnInit() {\n    this.tradeinForm = this.initTradeInForm();\n    this.subs.add(this.parseURL());\n  }\n\n  parseURL() {\n    this.tradein = new TradeIn();\n    this.opp = new Opportunity();\n    return this.route.paramMap.subscribe((params) => {\n      console.log(params);\n      this.tradein.OpportunityId = params.get(TradeinProfilePageRoutingKeys.PARAM_ID);\n      this.tradein.ContactId = params.get(TradeinProfilePageRoutingKeys.CONTACT_ID);\n      this.getData();\n    });\n  }\n\n  getData() {\n    this.translate\n      .get('Common_Loading')\n      .pipe(\n        mergeMap((lang) => {\n          return from(\n            this.loadingCtrl.create({\n              message: lang,\n            })\n          );\n        }),\n        mergeMap((loading) => {\n          loading.present();\n          return forkJoin([\n            this.oppSrvc.getOpportunityById(this.tradein.OpportunityId).pipe(\n              tap(\n                (e) => {\n                  this.opp = e;\n                  // this.tradein.ContactId = this.opp.ContactId;\n                  loading.dismiss();\n                },\n                (err) => {\n                  loading.dismiss();\n                }\n              )\n            ),\n          ]).pipe(\n            tap(\n              (e) => {\n                loading.dismiss();\n              },\n              (err) => {\n                loading.dismiss();\n              }\n            )\n          );\n        })\n      )\n      .subscribe();\n  }\n\n  selectPurchaser() {\n    from(\n      this.modalCtrl.create({\n        component: AutocompleteComponent,\n        componentProps: {\n          callbackFn: (searchStr: string) => {\n            return this.tradeinSrvc.getPurchasers(searchStr);\n          },\n          transformFn: (purchaser: Purchaser) => {\n            return new AutoCompleteModel({\n              Title: purchaser.Name,\n            });\n          },\n          noResultFn: (searchStr: string) => {},\n          backdropDismiss: false,\n        },\n      })\n    ).subscribe((modal) => {\n      from(modal.onDidDismiss()).subscribe((modalData) => {\n        console.log(modalData);\n        if (modalData && modalData.data) {\n          this.tradein.Purchaser = modalData.data.Id;\n          this.tradein.Company = modalData.data.Company;\n          this.tradeinForm.get('purchaser').setValue(modalData.data.Name);\n        }\n      });\n      modal.present();\n    });\n  }\n\n  private initTradeInForm() {\n    const tradeinForm = this.formBuilder.group({\n      id: [''],\n      regNo: ['', [Validators.required]],\n      purchaser: ['', [Validators.required]],\n      mileage: ['', [Validators.required]],\n      remarks: [''],\n    });\n    this.initErrorMessages(tradeinForm);\n    return tradeinForm;\n  }\n\n  private initErrorMessages(form: FormGroup) {\n    this.translate.get('Error_CannotBeEmpty').subscribe((lang) => {\n      this.formErrorMessages = {\n        group: {},\n      };\n      if (!form) {\n        return;\n      }\n      for (const key of Object.keys(form.controls)) {\n        switch (key) {\n          case 'regNo':\n          case 'purchaser':\n          case 'mileage':\n            this.formErrorMessages[key] = {\n              required: lang,\n            };\n            break;\n          default:\n            break;\n        }\n      }\n    });\n  }\n\n  setTradein(td: TradeIn) {\n    this.tradein = td;\n  }\n\n  done() {\n    this.tradein.RegNo = this.tradeinForm.get('regNo').value;\n    this.tradein.Mileage = this.tradeinForm.get('mileage').value;\n    this.tradein.Notes = this.tradeinForm.get('remarks').value;\n    this.translate\n      .get('Common_Saving')\n      .pipe(\n        mergeMap((lang) => {\n          return from(\n            this.loadingCtrl.create({\n              message: lang,\n            })\n          );\n        }),\n        mergeMap((loading) => {\n          loading.present();\n          return this.tradeinSrvc.upsertTradeIn(this.tradein).pipe(\n            tap(\n              (e) => {\n                this.tradein = e[0];\n                loading.dismiss();\n              },\n              (err) => {\n                loading.dismiss();\n              }\n            )\n          );\n        })\n      )\n      .subscribe((e) => {\n        this.navCtrl.back();\n        setTimeout((_) => {\n          this.navCtrl.navigateForward(TradeinViewProfilePageRoutingKeys.BASE + '/' + this.tradein.Id);\n        }, 1000);\n      });\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { TradeinProfilePageRoutingModule } from './tradein-profile-routing.module';\n\nimport { TradeinProfilePage } from './tradein-profile.page';\nimport { TranslateModule } from '@ngx-translate/core';\nimport { ItemErrComponentModule } from 'src/app/components/common/item-err/item-err.module';\nimport { TradeinFormMyComponent } from './components/tradein-form-my/tradein-form-my.component';\n\n@NgModule({\n  imports: [CommonModule, FormsModule, IonicModule, ReactiveFormsModule, TranslateModule, ItemErrComponentModule, TradeinProfilePageRoutingModule],\n  declarations: [TradeinProfilePage, TradeinFormMyComponent],\n})\nexport class TradeinProfilePageModule {}\n"],"sourceRoot":"webpack:///"}